<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Vladikavkaz Street Names</title>
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet" />

	<style>
		body {
			margin: 0;
			padding: 0;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}

		.mapboxgl-popup-content h3 {
			background: #ccc;
			color: #fff;
			margin: 10;
			display: inline;
			padding: 2px;
			font-weight: 500;
			margin-top: 0px;
			font-size: 14px;
		}

		.mapboxgl-popup-content h4 {
			margin: 0;
			display: block;
			padding: 0px;
			font-weight: 500;
			margin-top: 0px;
			font-size: 14px;
		}

		.mapboxgl-popup-content p {
			margin: 0;
			display: block;
			padding: 0px;
			font-weight: 400;
			margin-top: 0px;
			font-size: 11px;
		}

		.mapboxgl-popup-content h5 {
			margin: 0;
			display: block;
			padding: 0px;
			font-weight: 500;
			margin-top: 0px;
			font-size: 12px;
		}


		.mapboxgl-popup-content-wrapper {
			padding: 10%;
		}
	</style>

</head>

<body>
	<div id="map"></div>
	<script>
		mapboxgl.accessToken = 'pk.eyJ1IjoibmlubGluIiwiYSI6ImNqanR0Zzc4bzI5b2Ezd2xlb2ZmbzdrOHMifQ.nhMfjVcApf7oZVzhlMnRLA';
		var map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/ninlin/ckl5cvgrr482x17rmyzky494g',
			center: [44.67, 43.025],
			zoom: 12
		});


		map.on('load', function() {
			map.addSource('route', {
				'type': 'geojson',
				'data': 'https://raw.githubusercontent.com/Ninlin/irystory/main/streets_20210215.geojson'
			});
			map.addLayer({
				'id': 'route',
				'type': 'line',
				'source': 'route',
				'layout': {
					'line-join': 'round',
					'line-cap': 'round'
				},
				'paint': {
					'line-color': [
						'match',
						['get', 'cat_new'],
						'military_ww',
						'#009665',
						'culture',
						'#F3CE75',
						'revolutionary, communist',
						'#EA0A8D',
						'russian',
						'#5F239A',
						'air',
						'#1B98E4',
						/* other */
						'#ccc'
					],
					'line-width': 2
				}
			});
			map.addLayer({
				'id': 'outline',
				'type': 'line',
				'source': 'route',
				'layout': {
					'line-join': 'round',
					'line-cap': 'round'
				},
				'paint': {
					'line-gap-width': 20,
					'line-width': 3,
					'line-color': 'white',
					'line-opacity': 0
				}

			})


			var popup = new mapboxgl.Popup({
				closeButton: false,
				closeOnClick: false
			});

			map.on('mouseenter', 'route', function(e) {
				map.getCanvas().style.cursor = 'pointer';

				var coordinates = e.features[0].geometry.coordinates.slice();
				var name = e.features[0].properties.name;
				var occupation = e.features[0].properties.occupation;
				var full_name = e.features[0].properties.full_name;
				var birth = e.features[0].properties.date_birth;
				var death = e.features[0].properties.date_death;
				// Ensure that if the map is zoomed out such that multiple
				// copies of the feature are visible, the popup appears
				// over the copy being pointed to.



				// Populate the popup and set its coordinates
				// based on the feature found.
				if (full_name != "null") {
					popup
						.setLngLat(e.lngLat)
						.setHTML("<h3>" + name + "</h3>" +
							"<h4>" + full_name + '</h4>' +
							'<h5>' + birth + '-' + death + '</h5>' +
							'<p>' + occupation + '</p>')
						.addTo(map);
				} else {
					popup
						.setLngLat(e.lngLat)
						.setHTML("<h3>" + name + "</h3>")
						.addTo(map);
				};


			});
			map.on('mouseleave', 'outline', function() {
				map.getCanvas().style.cursor = '';
				popup.remove();
			});
		});
	</script>

</body>

</html>
